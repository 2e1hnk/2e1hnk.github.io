<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" href="/media/css/all.css">

    <title>2m/70cm UKAC May 2019</title>
    <meta name="description" content="Test
">

      <!-- LeafletJS CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="">
  <link rel="stylesheet" href="/media/css/L.fullscreen.css" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
  <script src="/media/js/leaflet-heatmap.js"></script>
  <script src="/media/js/HamGridSquare.js"></script>
  <script src="/media/js/adif.js"></script>
  <script src="/media/js/chart.min.js"></script>
        
    <style>
      .header {
        background-image: url(/media/images/antennafield.jpg);
        background-position-x: 50%;
        background-position-y: 50%;
        background-size: 100%;
        display: block;
        background-attachment: fixed;
        color: white;
        text-align: center;
        vertical-align: middle;
        margin-bottom: 20px;
      }

      .header-text {
        padding-top: 100px;
        padding-bottom: 100px;
      }

      section {
        padding-top: 10px;
      }

      footer {
        margin-top: 50px;
        padding-top: 20px;
        padding-bottom: 20px;
      }
    </style>

  </head>
  <body id="ukac-may-2019">
    <div class="container-fluid header">
      <div class="col-md-8 offset-md-2">
        <nav class="navbar navbar-expand-lg navbar-dark bg-transparent">
          <a class="navbar-brand" href="#">2E1HNK</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                                          <li class="nav-item">
                <a class="nav-link" href="/about.html">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/blog/">Blog</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/contests/">Contest Reports</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/projects/">Projects</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Tools
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/ogps/">OGPS</a>
                  <a class="dropdown-item" href="/morsechallenge/">Morse Challenge</a>
                  <!--
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                  -->
                </div>
              </li>
            </ul>
            <!--
            <form class="form-inline my-2 my-lg-0">
              <input id="searchCallsign" class="form-control mr-sm-2" type="search" placeholder="Search the Logbook" aria-label="Search">
              <button class="btn btn-outline-success my-2 my-sm-0" id="btnLogSearch">Search</button>
            </form>
            -->
          </div>
        </nav>

        <h1 class="header-text display-1">  2m/70cm UKAC May 2019
</h1>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-8 offset-md-2">
          <section>
    <em class="text-muted">By Matt, 2E1HNK on <time datetime="2019-05-14">Tue, 14 May 2019</time></em>
  </section>

  <section>
          <div class="tags">
              <a class="btn btn-outline-secondary btn-sm" href="/blog/tags/UKAC.html">UKAC</a>
              <a class="btn btn-outline-secondary btn-sm" href="/blog/tags/Activation.html">Activation</a>
          </div>
  
  </section>

  <section>
      </section>

  <section>
    <p>This was my best month to date, 2m felt fantastic and I kept up a good rate so even though others worked more bonus squares than me I'm still confident for a good result. 70cm was also good but felt frustrating - others were clearly taking advantage of tropo openings that I couldn't seem to get in to.</p>  </section>


      <br />
    <h2>2M</h2>
          <div id="stats-2M">
  <p>Total QSOs: <span id="stats-2M-totalqsos">?</span></p>
  <p>Total Points: <span id="stats-2M-total">?</span> (<span id="stats-2M-points">?</span> QSO points + <span id="stats-2M-bonus">?</span> bonus points)</p>
  <p>ODX: <span id="stats-2M-odx">?</span></p>
</div>

<script>
  var myLocation = [];
  gridSquareToLatLon("IO92ba", myLocation);

  readTextFile("/media/logs/2E1HNK_2019_05_07_144 MHz.adi", function(log) {
    totalQsos = 0;
    odxDist = 0;
    points = 0;
    bonusSquares = [];
    odx = "";
    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        if ( distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude) > odxDist ) {
          odxDist = distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude);
          odx = log[i].callsign + " (" + log[i].locator + ", " + Math.round(odxDist) + "km)"
        }
      }
      if ( !bonusSquares.includes(log[i].locator.substring(0,4)) ) {
        bonusSquares.push(log[i].locator.substring(0,4));
      }
      totalQsos++;
      points += log[i].points;
    }
    document.getElementById("stats-2M-totalqsos").textContent = totalQsos;
    document.getElementById("stats-2M-points").textContent = points;
    document.getElementById("stats-2M-bonus").textContent = bonusSquares.length * 500;
    document.getElementById("stats-2M-total").textContent = points + bonusSquares.length * 500;
    document.getElementById("stats-2M-odx").textContent = odx;
  });
</script>


        <div id="container" style="width: 100%;">
  <canvas id="rateChart-2M" class="rate-chart"></canvas>
</div>
<div style="height: 450px" id="map-2M"></div>

<script src="/media/js/chartjs.plugin.annotation.js"></script>
<script src="/media/js/L.maidenheadcoloured.js"></script>
<script src="/media/js/L.fullscreen.js"></script>
<script>
  var myLocation = [];

  gridSquareToLatLon("IO92ba", myLocation);

  var osmLayer2M = L.tileLayer('//tileserver.eastus.cloudapp.azure.com/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'ham'
  });

  var lightTiles2M = L.tileLayer('//cartodb-basemaps-{s}.global.ssl.fastly.net/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by Carto, under CC BY 3.0. Data by <a href="//www.openstreetmap.org/">OpenStreetMap</a>, under ODbL.',
    maxZoom: 18,
    id: 'light_all'
  });

  var darkTiles2M = L.tileLayer('//cartodb-basemaps-{s}.global.ssl.fastly.net/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by Carto, under CC BY 3.0. Data by <a href="//www.openstreetmap.org/">OpenStreetMap</a>, under ODbL.',
    maxZoom: 18,
    id: 'dark_all'
  });

  var portableIcon = L.icon({
    iconUrl: '/media/svg/portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var mobileIcon = L.icon({
    iconUrl: '/media/svg/mobile.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var baseIcon = L.icon({
    iconUrl: '/media/svg/base.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var myIcon = L.icon({
    iconUrl: '/media/svg/me-portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30]  // point from which the popup should open relative to the iconAnchor
  });

  var heatmapLayer2M = L.heatLayer([], {radius: 80, maxZoom: 16});

  var stationsLayer2M = L.featureGroup([]);

  var gridLayer2M = L.maidenhead({ worked: [], confirmed: [] });
  gridLayer2M._map = map2M;

  stationsLayer2M.addLayer(
    L.marker(
      [myLocation.lat, myLocation.lon],
      {icon: myIcon}
    ).bindPopup(
      "<b>IO92ba<br />"
    )
  );

  readTextFile("/media/logs/2E1HNK_2019_05_07_144 MHz.adi", function(log) {
    rate2M = {};
    opmode2M = [];
    var currMode = "s_p";
    var lastRunStart = "";

    rateGroupInterval = 5;   // Interval (in minutes) to group QSOs for the rate graph

    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        var added = false;
        for ( var j=0; j<heatmapLayer2M._latlngs.length; j++ ) {
          if ( heatmapLayer2M._latlngs[j][0] == log[i].latitude && heatmapLayer2M._latlngs[j][1] == log[i].longitude ) {
            var count = heatmapLayer2M._latlngs[j][2] + 1;
            console.log("In heatmap, setting count to " + count);
            heatmapLayer2M._latlngs[j] = [log[i].latitude, log[i].longitude, count];
            added = true;
          }
        }
        if ( !added ) {
          heatmapLayer2M.addLatLng([log[i].latitude, log[i].longitude, 1]);
        }

        console.log(heatmapLayer2M);
        if ( log[i].callsign.endsWith("/P") ) {
          var iconType = portableIcon;
        } else if ( log[i].callsign.endsWith("/M") ) {
          var iconType = mobileIcon;
        } else {
          var iconType = baseIcon;
        }
          stationsLayer2M.addLayer(
            L.marker(
              [log[i].latitude, log[i].longitude],
              {icon: iconType}
            ).bindPopup(
              "<table>" +
              "<tr><th colspan=2><b>" + log[i].callsign + "</b></th></tr>" +
              "<tr><th>Locator:</th><td>" + log[i].locator + "</td></tr>" +
              "<tr><th>Date:</th><td>" + log[i].date.substr(0,4) + "-" + log[i].date.substr(4,2) + "-" + log[i].date.substr(6,2) + "</td></tr>" +
              "<tr><th>Time:</th><td>" + log[i].time.substr(0,2) +":" + log[i].time.substr(2,2) + "</td></tr>" +
              "<tr><th>TX:</th><td>" + log[i].rst_tx + " / " + log[i].serial_tx + "</td></tr>" +
              "<tr><th>RX:</th><td>" + log[i].rst_rx + " / " + log[i].serial_rx + "</td></tr>" +
              "</table>"
            )
          );
      } else if ( log[i].locator ) {
        latlng = gridSquareToLatLon(log[i].locator, log[i]);
        heatmapLayer2M.addLatLng([log[i].lat, log[i].lon, 1]);
      }

      // Add to grid shading
      if ( log[i].locator ) {
        gridLayer2M.grids.worked.push(log[i].locator);
      }
      gridLayer2M.redraw();

      // Add QSO to rate object
      rateKey = log[i].date + " " + Math.floor(parseInt(log[i].time) / rateGroupInterval) * rateGroupInterval;
      rateKey in rate2M ? rate2M[rateKey]++ : rate2M[rateKey] = 1;

      // Work out if we were running or S&P
      if ( i > 1 && i < (log.length-1) ) {
        if ( log[i].frequency == log[i+1].frequency || log[i].frequency == log[i-1].frequency ) {
          // in run mode
          if (currMode == "s_p") {
            // Start a new run session
            lastRunStart = log[i].date + " " + log[i].time;
            currMode = "run";
          } // else still running
        } else {
          if (currMode == "run") {
            // End a run session
            opmode2M.push([lastRunStart, log[i].date + " " + log[i].time]);
            currMode = "s_p";
          } // else still s_p
        }
      }
    }

    map2M.fitBounds(stationsLayer2M.getBounds().pad(0.5));

    console.log("rate", rate2M);

    var chartData2M = {
      labels: Object.keys(rate2M),
      datasets: [{
        label: "QSOs per " + rateGroupInterval + " mins",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: Object.values(rate2M)
      },{
        label: "",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: opmode2M
      }]
    };

    console.log("chartData", chartData2M);


    // Draw the rate chart
    //window.onload = function() {
      var ctx2M = document.getElementById('rateChart-2M').getContext('2d');
      window.rateBarChart2M = new Chart(ctx2M, {
        type: 'line',
        data: chartData2M,
        options: {
          responsive: true,
          run_periods: opmode2M,
          chartArea: {
            backgroundColor: 'rgba(251, 85, 85, 0.4)'
          },
          legend: {
            position: 'top',
          },
          title: {
            display: true,
            text: '2M Rate Chart'
          },
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          }
        },
        plugins: {
          annotation: {
            drawTime: 'afterDatasetsDraw',
            annotations: [{
      				id: 'a-line-1', // optional
      				type: 'line',
      				mode: 'horizontal',
      				scaleID: 'y-axis-0',
      				value: '2',
      				borderColor: 'red',
      				borderWidth: 2,

      				// Fires when the user clicks this annotation on the chart
      				// (be sure to enable the event in the events array below).
      				onClick: function(e) {
      					// `this` is bound to the annotation element
      				}
      			}]
          }
        }
      });
      console.log("rate chart", window.rateBarChart2M);
    //};
  });

  heatmapLayer2M.redraw();

  var basemaps2M = {"OpenStreetMap": osmLayer2M, "Carto Light": lightTiles2M, "Carto Dark": darkTiles2M};
  var overlayMaps2M = {"Grid": gridLayer2M, "Heatmap": heatmapLayer2M, "Stations": stationsLayer2M};

  var map2M = new L.map('map-2M', {
    zoom: 6,
    attributionControl: true,
    fullscreenControl: true,
    layers: [lightTiles2M, heatmapLayer2M, gridLayer2M, stationsLayer2M]
  });
  //map2M.setView([51.945732, -1.926986], 6);
  map2M.fitBounds(stationsLayer2M.getBounds().pad(0.5));

  L.control.layers(basemaps2M, overlayMaps2M).addTo(map2M);

</script>


      <br />
    <h2>70cm</h2>
          <div id="stats-70cm">
  <p>Total QSOs: <span id="stats-70cm-totalqsos">?</span></p>
  <p>Total Points: <span id="stats-70cm-total">?</span> (<span id="stats-70cm-points">?</span> QSO points + <span id="stats-70cm-bonus">?</span> bonus points)</p>
  <p>ODX: <span id="stats-70cm-odx">?</span></p>
</div>

<script>
  var myLocation = [];
  gridSquareToLatLon("IO92ba", myLocation);

  readTextFile("/media/logs/2E1HNK_2019_05_14_432 MHz.adi", function(log) {
    totalQsos = 0;
    odxDist = 0;
    points = 0;
    bonusSquares = [];
    odx = "";
    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        if ( distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude) > odxDist ) {
          odxDist = distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude);
          odx = log[i].callsign + " (" + log[i].locator + ", " + Math.round(odxDist) + "km)"
        }
      }
      if ( !bonusSquares.includes(log[i].locator.substring(0,4)) ) {
        bonusSquares.push(log[i].locator.substring(0,4));
      }
      totalQsos++;
      points += log[i].points;
    }
    document.getElementById("stats-70cm-totalqsos").textContent = totalQsos;
    document.getElementById("stats-70cm-points").textContent = points;
    document.getElementById("stats-70cm-bonus").textContent = bonusSquares.length * 500;
    document.getElementById("stats-70cm-total").textContent = points + bonusSquares.length * 500;
    document.getElementById("stats-70cm-odx").textContent = odx;
  });
</script>


        <div id="container" style="width: 100%;">
  <canvas id="rateChart-70cm" class="rate-chart"></canvas>
</div>
<div style="height: 450px" id="map-70cm"></div>

<script src="/media/js/chartjs.plugin.annotation.js"></script>
<script src="/media/js/L.maidenheadcoloured.js"></script>
<script src="/media/js/L.fullscreen.js"></script>
<script>
  var myLocation = [];

  gridSquareToLatLon("IO92ba", myLocation);

  var osmLayer70cm = L.tileLayer('//tileserver.eastus.cloudapp.azure.com/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'ham'
  });

  var lightTiles70cm = L.tileLayer('//cartodb-basemaps-{s}.global.ssl.fastly.net/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by Carto, under CC BY 3.0. Data by <a href="//www.openstreetmap.org/">OpenStreetMap</a>, under ODbL.',
    maxZoom: 18,
    id: 'light_all'
  });

  var darkTiles70cm = L.tileLayer('//cartodb-basemaps-{s}.global.ssl.fastly.net/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map tiles by Carto, under CC BY 3.0. Data by <a href="//www.openstreetmap.org/">OpenStreetMap</a>, under ODbL.',
    maxZoom: 18,
    id: 'dark_all'
  });

  var portableIcon = L.icon({
    iconUrl: '/media/svg/portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var mobileIcon = L.icon({
    iconUrl: '/media/svg/mobile.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var baseIcon = L.icon({
    iconUrl: '/media/svg/base.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var myIcon = L.icon({
    iconUrl: '/media/svg/me-portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30]  // point from which the popup should open relative to the iconAnchor
  });

  var heatmapLayer70cm = L.heatLayer([], {radius: 80, maxZoom: 16});

  var stationsLayer70cm = L.featureGroup([]);

  var gridLayer70cm = L.maidenhead({ worked: [], confirmed: [] });
  gridLayer70cm._map = map70cm;

  stationsLayer70cm.addLayer(
    L.marker(
      [myLocation.lat, myLocation.lon],
      {icon: myIcon}
    ).bindPopup(
      "<b>IO92ba<br />"
    )
  );

  readTextFile("/media/logs/2E1HNK_2019_05_14_432 MHz.adi", function(log) {
    rate70cm = {};
    opmode70cm = [];
    var currMode = "s_p";
    var lastRunStart = "";

    rateGroupInterval = 5;   // Interval (in minutes) to group QSOs for the rate graph

    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        var added = false;
        for ( var j=0; j<heatmapLayer70cm._latlngs.length; j++ ) {
          if ( heatmapLayer70cm._latlngs[j][0] == log[i].latitude && heatmapLayer70cm._latlngs[j][1] == log[i].longitude ) {
            var count = heatmapLayer70cm._latlngs[j][2] + 1;
            console.log("In heatmap, setting count to " + count);
            heatmapLayer70cm._latlngs[j] = [log[i].latitude, log[i].longitude, count];
            added = true;
          }
        }
        if ( !added ) {
          heatmapLayer70cm.addLatLng([log[i].latitude, log[i].longitude, 1]);
        }

        console.log(heatmapLayer70cm);
        if ( log[i].callsign.endsWith("/P") ) {
          var iconType = portableIcon;
        } else if ( log[i].callsign.endsWith("/M") ) {
          var iconType = mobileIcon;
        } else {
          var iconType = baseIcon;
        }
          stationsLayer70cm.addLayer(
            L.marker(
              [log[i].latitude, log[i].longitude],
              {icon: iconType}
            ).bindPopup(
              "<table>" +
              "<tr><th colspan=2><b>" + log[i].callsign + "</b></th></tr>" +
              "<tr><th>Locator:</th><td>" + log[i].locator + "</td></tr>" +
              "<tr><th>Date:</th><td>" + log[i].date.substr(0,4) + "-" + log[i].date.substr(4,2) + "-" + log[i].date.substr(6,2) + "</td></tr>" +
              "<tr><th>Time:</th><td>" + log[i].time.substr(0,2) +":" + log[i].time.substr(2,2) + "</td></tr>" +
              "<tr><th>TX:</th><td>" + log[i].rst_tx + " / " + log[i].serial_tx + "</td></tr>" +
              "<tr><th>RX:</th><td>" + log[i].rst_rx + " / " + log[i].serial_rx + "</td></tr>" +
              "</table>"
            )
          );
      } else if ( log[i].locator ) {
        latlng = gridSquareToLatLon(log[i].locator, log[i]);
        heatmapLayer70cm.addLatLng([log[i].lat, log[i].lon, 1]);
      }

      // Add to grid shading
      if ( log[i].locator ) {
        gridLayer70cm.grids.worked.push(log[i].locator);
      }
      gridLayer70cm.redraw();

      // Add QSO to rate object
      rateKey = log[i].date + " " + Math.floor(parseInt(log[i].time) / rateGroupInterval) * rateGroupInterval;
      rateKey in rate70cm ? rate70cm[rateKey]++ : rate70cm[rateKey] = 1;

      // Work out if we were running or S&P
      if ( i > 1 && i < (log.length-1) ) {
        if ( log[i].frequency == log[i+1].frequency || log[i].frequency == log[i-1].frequency ) {
          // in run mode
          if (currMode == "s_p") {
            // Start a new run session
            lastRunStart = log[i].date + " " + log[i].time;
            currMode = "run";
          } // else still running
        } else {
          if (currMode == "run") {
            // End a run session
            opmode70cm.push([lastRunStart, log[i].date + " " + log[i].time]);
            currMode = "s_p";
          } // else still s_p
        }
      }
    }

    map70cm.fitBounds(stationsLayer70cm.getBounds().pad(0.5));

    console.log("rate", rate70cm);

    var chartData70cm = {
      labels: Object.keys(rate70cm),
      datasets: [{
        label: "QSOs per " + rateGroupInterval + " mins",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: Object.values(rate70cm)
      },{
        label: "",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: opmode70cm
      }]
    };

    console.log("chartData", chartData70cm);


    // Draw the rate chart
    //window.onload = function() {
      var ctx70cm = document.getElementById('rateChart-70cm').getContext('2d');
      window.rateBarChart70cm = new Chart(ctx70cm, {
        type: 'line',
        data: chartData70cm,
        options: {
          responsive: true,
          run_periods: opmode70cm,
          chartArea: {
            backgroundColor: 'rgba(251, 85, 85, 0.4)'
          },
          legend: {
            position: 'top',
          },
          title: {
            display: true,
            text: '70cm Rate Chart'
          },
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: true
              }
            }]
          }
        },
        plugins: {
          annotation: {
            drawTime: 'afterDatasetsDraw',
            annotations: [{
      				id: 'a-line-1', // optional
      				type: 'line',
      				mode: 'horizontal',
      				scaleID: 'y-axis-0',
      				value: '2',
      				borderColor: 'red',
      				borderWidth: 2,

      				// Fires when the user clicks this annotation on the chart
      				// (be sure to enable the event in the events array below).
      				onClick: function(e) {
      					// `this` is bound to the annotation element
      				}
      			}]
          }
        }
      });
      console.log("rate chart", window.rateBarChart70cm);
    //};
  });

  heatmapLayer70cm.redraw();

  var basemaps70cm = {"OpenStreetMap": osmLayer70cm, "Carto Light": lightTiles70cm, "Carto Dark": darkTiles70cm};
  var overlayMaps70cm = {"Grid": gridLayer70cm, "Heatmap": heatmapLayer70cm, "Stations": stationsLayer70cm};

  var map70cm = new L.map('map-70cm', {
    zoom: 6,
    attributionControl: true,
    fullscreenControl: true,
    layers: [lightTiles70cm, heatmapLayer70cm, gridLayer70cm, stationsLayer70cm]
  });
  //map70cm.setView([51.945732, -1.926986], 6);
  map70cm.fitBounds(stationsLayer70cm.getBounds().pad(0.5));

  L.control.layers(basemaps70cm, overlayMaps70cm).addTo(map70cm);

</script>


          </div>
      </div>
    </div>

    <footer class="bg-dark">
      <div class="container">
        <div class="row">
          <div class="col-md-2 offset-md-3 text-center">
            <a href="https://twitter.com/2e1hnk"><i class="fab fa-twitter display-4 text-light"></i></a>
          </div>
          <div class="col-md-2 text-center">
            <a href="https://github.com/2e1hnk"><i class="fab fa-github display-4 text-light"></i></a>
          </div>
          <div class="col-md-2 text-center">
            <a href="https://reddit.com/user/2e1hnk"><i class="fab fa-reddit display-4 text-light"></i></a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script type="text/javascript">
        document.getElementById("btnLogSearch").onclick = function () {
            var url = "/logsearch.html?callsign=" + document.getElementById("searchCallsign").value;
            location.href(url);
            return false;
        };
    </script>
  </body>
</html>