<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="description" content="Test
">
    <meta name="author" content="Matt, 2E1HNK">
    <meta name="viewport" content="">
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-138987624-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-138987624-1');
    </script>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/media/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/media/css/beantech.min.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/media/css/highlight.css">
    <link rel="stylesheet" href="/media/css/widget.css">
    <link rel="stylesheet" href="/media/css/rocket.css">
    <link rel="stylesheet" href="/media/css/toc.css">

    <!-- Custom Fonts -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    
    <title>2m FMAC/UKAC August 2018</title>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="/media/images/android-desktop.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Material Design Lite">
    <link rel="apple-touch-icon-precomposed" href="/media/images/ios-desktop.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/media/images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <link rel="shortcut icon" href="/media/images/favicon.png">

    <!-- LeafletJS CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="">

        <!-- Place favicon.ico & apple-touch-icon.png
          in the root of your domain and delete these references -->
    <link rel="shortcut icon" href="/media/images/favicon.ico">
    <link rel="apple-touch-icon" href="/media/images/apple-touch-icon.png">
    
    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->

    
    <style type="text/css">
      header.intro-header {
        background-image: url(/media/images/antennafield.jpg);
      }
    </style>
    
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
  <script src="/media/js/leaflet-heatmap.js"></script>
  <script src="/media/js/HamGridSquare.js"></script>
  <script src="/media/js/adif.js"></script>
  <script src="/media/js/chart.min.js"></script>
          </head>
  <body id="fmac-ukac-august-2018" ontouchstart="">
  
  <header class="intro-header" >
      <!-- Signature -->
      <div id="signature">
          <div class="container">
              <div class="row">
                  <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                      <div class="site-heading">
                          <h1>2E1HNK</h1>
                          <!--<hr class="small">-->
                          <span class="subheading"></span>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </header>

  <!-- Navigation -->
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">2E1HNK</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                  <li><a href="/">Home</a></li>
                  <li><a href="/about.html">About</a></li>
                  <li><a href="/blog">Blog</a></li>
                  <li><a href="/contests">Contest Reports</a></li>
                  <li><a href="/projects">Projects</a></li>
                  <li><a href="/ogps">OGPS</a></li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
  </nav>
  <script>
      // Drop Bootstrap low-performance Navbar
      // Use customize navbar with high-quality material design animation
      // in high-performance junk-free CSS3 implementation
      var $body   = document.body;
      var $toggle = document.querySelector('.navbar-toggle');
      var $navbar = document.querySelector('#huxblog_navbar');
      var $collapse = document.querySelector('.navbar-collapse');

      $toggle.addEventListener('click', handleMagic)
      function handleMagic(e){
          if ($navbar.className.indexOf('in') > 0) {
          // CLOSE
              $navbar.className = " ";
              // wait until animation end.
              setTimeout(function(){
                  // prevent frequently toggle
                  if($navbar.className.indexOf('in') < 0) {
                      $collapse.style.height = "0px"
                  }
              },400)
          }else{
          // OPEN
              $collapse.style.height = "auto"
              $navbar.className += " in";
          }
      }
  </script>

  <!-- Main Contents -->
  <div class="container">
    <div class="row">

      <!-- Post Container -->
      <div class="col-lg-8 col-lg-offset-1 col-md-8 col-md-offset-1 col-sm-12 col-xs-12 post-container">
        <h1>2m FMAC/UKAC August 2018</h1>

  <p class="post-meta" style="margin: 10px 0;">
    Posted by Matt, 2E1HNK on <time datetime="2018-08-08">Wed, 08 Aug 2018</time>
  </p>

      <div class="tags">
              <a class="pill" href="/blog/tags/FMAC.html">FMAC</a>
              <a class="pill" href="/blog/tags/UKAC.html">UKAC</a>
              <a class="pill" href="/blog/tags/Activation.html">Activation</a>
          </div>
  
  <p>Active as 2E1HNK/P from a new location - Sudeley Hill (IO91AW), using
10W from the FT-857d to the Diamond X200 for the FMAC section and a
borrowed 8 element yagi for UKAC. Generally a good evening however it
seemed to be harder work than it should have been, given that I was
using a much better antenna than normal.</p>
<p>Sudeley Hill is a good location, possibly not quite as good as Cutsdean
Hill RF-wise but there is more space to set up antennas and to actually
get the car off the road. Got some interesting looks form passers-by and
one stopped to chat, who happened to be a G8 from Cheltenham who was out
on his bike!</p>
<p>I didn't get on the air with enough time to make an impact on FMAC (currently
in last place) but was reasonably busy for the whole of the UKAC.</p>
<p>The beam was mounted on 2 sections of mast, giving a height of 3m. The mast
was braced against the side of the car putting the antenna about 1.2m above
the car, which probably isn't high enough. Plan for next time is to use 3 or 4
sections of mast putting the antenna at 4.5m or 6m AGL, however the two sections
that I used this time refused to come apart again. As it happens I can just
about fit the two sections in the car fitted together, however that won't work
if more sections get stuck!</p>
<h3>FMAC</h3>
<p>Section: 10W
Total QSOs: 5
Total Points: 281
Normalised Points: ???
ODX: MW6BWA/P (IO82JC - 88km)
Position: 13 (of 13) overall, 4 (of 4) in 10W section (based on claimed scores)</p>
<h3>UKAC</h3>
<p>Section: AL
Total QSOs: 37
Total Points: 9,921 (3,921 + 6,000 bonus)
Normalised Points: 571
ODX: EI2SDR/P (IO62XW - 299km)
Position: 31 (of 70) in AL section</p>      <h3>UKAC</h3>
          <div id="stats-UKAC">
  <p>Total QSOs: <span id="stats-UKAC-totalqsos">?</span></p>
  <p>Total Points: <span id="stats-UKAC-total">?</span> (<span id="stats-UKAC-points">?</span> QSO points + <span id="stats-UKAC-bonus">?</span> bonus points)</p>
  <p>ODX: <span id="stats-UKAC-odx">?</span></p>
</div>

<script>
  var myLocation = [];
  gridSquareToLatLon("IO91aw", myLocation);

  readTextFile("/media/logs/2E1HNK_2018_08_07_144 MHz_1.adi", function(log) {
    totalQsos = 0;
    odxDist = 0;
    points = 0;
    bonusSquares = [];
    odx = "";
    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        if ( distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude) > odxDist ) {
          odxDist = distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude);
          odx = log[i].callsign + " (" + log[i].locator + ", " + Math.round(odxDist) + "km)"
        }
      }
      if ( !bonusSquares.includes(log[i].locator.substring(0,4)) ) {
        bonusSquares.push(log[i].locator.substring(0,4));
      }
      totalQsos++;
      points += log[i].points;
    }
    document.getElementById("stats-UKAC-totalqsos").textContent = totalQsos;
    document.getElementById("stats-UKAC-points").textContent = points;
    document.getElementById("stats-UKAC-bonus").textContent = bonusSquares.length * 500;
    document.getElementById("stats-UKAC-total").textContent = points + bonusSquares.length * 500;
    document.getElementById("stats-UKAC-odx").textContent = odx;
  });
</script>


        <div id="container" style="width: 100%;">
  <canvas id="rateChart-UKAC" class="rate-chart"></canvas>
</div>
<div style="height: 450px" id="map-UKAC"></div>

<script src="/media/js/linealt.chart.js"></script>
<script>
  var myLocation = [];
  gridSquareToLatLon("IO91aw", myLocation);

  var osmLayerUKAC = L.tileLayer('//tileserver.eastus.cloudapp.azure.com/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'ham'
  });

  var portableIcon = L.icon({
    iconUrl: '/media/svg/portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var mobileIcon = L.icon({
    iconUrl: '/media/svg/mobile.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var baseIcon = L.icon({
    iconUrl: '/media/svg/base.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var myIcon = L.icon({
    iconUrl: '/media/svg/me-portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30]  // point from which the popup should open relative to the iconAnchor
  });

  var heatmapLayerUKAC = L.heatLayer([], {radius: 50, maxZoom: 10});

  var stationsLayerUKAC = L.featureGroup([]);

  stationsLayerUKAC.addLayer(
    L.marker(
      [myLocation.lat, myLocation.lon],
      {icon: myIcon}
    ).bindPopup(
      "<b>IO91aw<br />"
    )
  );

  readTextFile("/media/logs/2E1HNK_2018_08_07_144 MHz_1.adi", function(log) {
    rateUKAC = {};
    opmodeUKAC = [];
    var currMode = "s_p";
    var lastRunStart = "";

    rateGroupInterval = 5;   // Interval (in minutes) to group QSOs for the rate graph

    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        var added = false;
        for ( var j=0; j<heatmapLayerUKAC._latlngs.length; j++ ) {
          if ( heatmapLayerUKAC._latlngs[j][0] == log[i].latitude && heatmapLayerUKAC._latlngs[j][1] == log[i].longitude ) {
            var count = heatmapLayerUKAC._latlngs[j][2] + 1;
            console.log("In heatmap, setting count to " + count);
            heatmapLayerUKAC._latlngs[j] = [log[i].latitude, log[i].longitude, count];
            added = true;
          }
        }
        if ( !added ) {
          heatmapLayerUKAC.addLatLng([log[i].latitude, log[i].longitude, 1]);
        }

        console.log(heatmapLayerUKAC);
        if ( log[i].callsign.endsWith("/P") ) {
          var iconType = portableIcon;
        } else if ( log[i].callsign.endsWith("/M") ) {
          var iconType = mobileIcon;
        } else {
          var iconType = baseIcon;
        }
          stationsLayerUKAC.addLayer(
            L.marker(
              [log[i].latitude, log[i].longitude],
              {icon: iconType}
            ).bindPopup(
              "<table>" +
              "<tr><th colspan=2><b>" + log[i].callsign + "</b></th></tr>" +
              "<tr><th>Locator:</th><td>" + log[i].locator + "</td></tr>" +
              "<tr><th>Date:</th><td>" + log[i].date.substr(0,4) + "-" + log[i].date.substr(4,2) + "-" + log[i].date.substr(6,2) + "</td></tr>" +
              "<tr><th>Time:</th><td>" + log[i].time.substr(0,2) +":" + log[i].time.substr(2,2) + "</td></tr>" +
              "<tr><th>TX:</th><td>" + log[i].rst_tx + " / " + log[i].serial_tx + "</td></tr>" +
              "<tr><th>RX:</th><td>" + log[i].rst_rx + " / " + log[i].serial_rx + "</td></tr>" +
              "</table>"
            )
          );
      } else if ( log[i].locator ) {
        latlng = gridSquareToLatLon(log[i].locator, log[i]);
        heatmapLayerUKAC.addLatLng([log[i].lat, log[i].lon, 1]);
      }

      // Add QSO to rate object
      rateKey = log[i].date + " " + Math.floor(parseInt(log[i].time) / rateGroupInterval) * rateGroupInterval;
      rateKey in rateUKAC ? rateUKAC[rateKey]++ : rateUKAC[rateKey] = 1;

      // Work out if we were running or S&P
      if ( i > 1 && i < (log.length-1) ) {
        if ( log[i].frequency == log[i+1].frequency || log[i].frequency == log[i-1].frequency ) {
          // in run mode
          if (currMode == "s_p") {
            // Start a new run session
            lastRunStart = log[i].date + " " + log[i].time;
            currMode = "run";
          } // else still running
        } else {
          if (currMode == "run") {
            // End a run session
            opmodeUKAC.push([lastRunStart, log[i].date + " " + log[i].time]);
            currMode = "s_p";
          } // else still s_p
        }
      }
    }

    mapUKAC.fitBounds(stationsLayerUKAC.getBounds().pad(0.5));

    console.log("rate", rateUKAC);

    var chartDataUKAC = {
      labels: Object.keys(rateUKAC),
      datasets: [{
        label: "QSOs per " + rateGroupInterval + " mins",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: Object.values(rateUKAC)
      },{
        label: "",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: opmodeUKAC
      }]
    };

    console.log("chartData", chartDataUKAC);


    // Draw the rate chart
    //window.onload = function() {
      var ctxUKAC = document.getElementById('rateChart-UKAC').getContext('2d');
      window.rateBarChartUKAC = new Chart(ctxUKAC, {
        type: 'line',
        data: chartDataUKAC,
        options: {
          responsive: true,
          run_periods: opmodeUKAC,
          chartArea: {
            backgroundColor: 'rgba(251, 85, 85, 0.4)'
          },
          legend: {
            position: 'top',
          },
          title: {
            display: true,
            text: 'UKAC Rate Chart'
          }
        }
      });
      console.log("rate chart", window.rateBarChartUKAC);
    //};
  });

  heatmapLayerUKAC.redraw();

  var basemapsUKAC = {"OpenStreetMap": osmLayerUKAC};
  var overlayMapsUKAC = {"Heatmap (UKAC)": heatmapLayerUKAC, "Stations": stationsLayerUKAC};

  var mapUKAC = new L.map('map-UKAC', {
    zoom: 6,
    attributionControl: true,
    layers: [osmLayerUKAC, heatmapLayerUKAC, stationsLayerUKAC]
  });
  //mapUKAC.setView([51.945732, -1.926986], 6);
  mapUKAC.fitBounds(stationsLayerUKAC.getBounds().pad(0.5));

  L.control.layers(basemapsUKAC, overlayMapsUKAC).addTo(mapUKAC);

</script>


      <h3>FMAC</h3>
          <div id="stats-FMAC">
  <p>Total QSOs: <span id="stats-FMAC-totalqsos">?</span></p>
  <p>Total Points: <span id="stats-FMAC-total">?</span> (<span id="stats-FMAC-points">?</span> QSO points + <span id="stats-FMAC-bonus">?</span> bonus points)</p>
  <p>ODX: <span id="stats-FMAC-odx">?</span></p>
</div>

<script>
  var myLocation = [];
  gridSquareToLatLon("IO91aw", myLocation);

  readTextFile("/media/logs/2E1HNK_2018_08_07_144 MHz.adi", function(log) {
    totalQsos = 0;
    odxDist = 0;
    points = 0;
    bonusSquares = [];
    odx = "";
    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        if ( distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude) > odxDist ) {
          odxDist = distBetweenLocations(myLocation.lat, myLocation.lon, log[i].latitude, log[i].longitude);
          odx = log[i].callsign + " (" + log[i].locator + ", " + Math.round(odxDist) + "km)"
        }
      }
      if ( !bonusSquares.includes(log[i].locator.substring(0,4)) ) {
        bonusSquares.push(log[i].locator.substring(0,4));
      }
      totalQsos++;
      points += log[i].points;
    }
    document.getElementById("stats-FMAC-totalqsos").textContent = totalQsos;
    document.getElementById("stats-FMAC-points").textContent = points;
    document.getElementById("stats-FMAC-bonus").textContent = bonusSquares.length * 500;
    document.getElementById("stats-FMAC-total").textContent = points + bonusSquares.length * 500;
    document.getElementById("stats-FMAC-odx").textContent = odx;
  });
</script>


        <div id="container" style="width: 100%;">
  <canvas id="rateChart-FMAC" class="rate-chart"></canvas>
</div>
<div style="height: 450px" id="map-FMAC"></div>

<script src="/media/js/linealt.chart.js"></script>
<script>
  var myLocation = [];
  gridSquareToLatLon("IO91aw", myLocation);

  var osmLayerFMAC = L.tileLayer('//tileserver.eastus.cloudapp.azure.com/{id}/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="https://www.mapbox.com/">Mapbox</a>',
    maxZoom: 18,
    id: 'ham'
  });

  var portableIcon = L.icon({
    iconUrl: '/media/svg/portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var mobileIcon = L.icon({
    iconUrl: '/media/svg/mobile.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var baseIcon = L.icon({
    iconUrl: '/media/svg/base.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30] // point from which the popup should open relative to the iconAnchor
  });

  var myIcon = L.icon({
    iconUrl: '/media/svg/me-portable.svg',
    iconSize:     [30, 30], // size of the icon
    iconAnchor:   [15, 15], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -30]  // point from which the popup should open relative to the iconAnchor
  });

  var heatmapLayerFMAC = L.heatLayer([], {radius: 50, maxZoom: 10});

  var stationsLayerFMAC = L.featureGroup([]);

  stationsLayerFMAC.addLayer(
    L.marker(
      [myLocation.lat, myLocation.lon],
      {icon: myIcon}
    ).bindPopup(
      "<b>IO91aw<br />"
    )
  );

  readTextFile("/media/logs/2E1HNK_2018_08_07_144 MHz.adi", function(log) {
    rateFMAC = {};
    opmodeFMAC = [];
    var currMode = "s_p";
    var lastRunStart = "";

    rateGroupInterval = 5;   // Interval (in minutes) to group QSOs for the rate graph

    for(var i=0; i<log.length; i++) {
      if ( log[i].latitude && log[i].longitude ) {
        var added = false;
        for ( var j=0; j<heatmapLayerFMAC._latlngs.length; j++ ) {
          if ( heatmapLayerFMAC._latlngs[j][0] == log[i].latitude && heatmapLayerFMAC._latlngs[j][1] == log[i].longitude ) {
            var count = heatmapLayerFMAC._latlngs[j][2] + 1;
            console.log("In heatmap, setting count to " + count);
            heatmapLayerFMAC._latlngs[j] = [log[i].latitude, log[i].longitude, count];
            added = true;
          }
        }
        if ( !added ) {
          heatmapLayerFMAC.addLatLng([log[i].latitude, log[i].longitude, 1]);
        }

        console.log(heatmapLayerFMAC);
        if ( log[i].callsign.endsWith("/P") ) {
          var iconType = portableIcon;
        } else if ( log[i].callsign.endsWith("/M") ) {
          var iconType = mobileIcon;
        } else {
          var iconType = baseIcon;
        }
          stationsLayerFMAC.addLayer(
            L.marker(
              [log[i].latitude, log[i].longitude],
              {icon: iconType}
            ).bindPopup(
              "<table>" +
              "<tr><th colspan=2><b>" + log[i].callsign + "</b></th></tr>" +
              "<tr><th>Locator:</th><td>" + log[i].locator + "</td></tr>" +
              "<tr><th>Date:</th><td>" + log[i].date.substr(0,4) + "-" + log[i].date.substr(4,2) + "-" + log[i].date.substr(6,2) + "</td></tr>" +
              "<tr><th>Time:</th><td>" + log[i].time.substr(0,2) +":" + log[i].time.substr(2,2) + "</td></tr>" +
              "<tr><th>TX:</th><td>" + log[i].rst_tx + " / " + log[i].serial_tx + "</td></tr>" +
              "<tr><th>RX:</th><td>" + log[i].rst_rx + " / " + log[i].serial_rx + "</td></tr>" +
              "</table>"
            )
          );
      } else if ( log[i].locator ) {
        latlng = gridSquareToLatLon(log[i].locator, log[i]);
        heatmapLayerFMAC.addLatLng([log[i].lat, log[i].lon, 1]);
      }

      // Add QSO to rate object
      rateKey = log[i].date + " " + Math.floor(parseInt(log[i].time) / rateGroupInterval) * rateGroupInterval;
      rateKey in rateFMAC ? rateFMAC[rateKey]++ : rateFMAC[rateKey] = 1;

      // Work out if we were running or S&P
      if ( i > 1 && i < (log.length-1) ) {
        if ( log[i].frequency == log[i+1].frequency || log[i].frequency == log[i-1].frequency ) {
          // in run mode
          if (currMode == "s_p") {
            // Start a new run session
            lastRunStart = log[i].date + " " + log[i].time;
            currMode = "run";
          } // else still running
        } else {
          if (currMode == "run") {
            // End a run session
            opmodeFMAC.push([lastRunStart, log[i].date + " " + log[i].time]);
            currMode = "s_p";
          } // else still s_p
        }
      }
    }

    mapFMAC.fitBounds(stationsLayerFMAC.getBounds().pad(0.5));

    console.log("rate", rateFMAC);

    var chartDataFMAC = {
      labels: Object.keys(rateFMAC),
      datasets: [{
        label: "QSOs per " + rateGroupInterval + " mins",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: Object.values(rateFMAC)
      },{
        label: "",
        backgroundColor: '#5695c8',
				borderColor: '#31517a',
				borderWidth: 1,
        fill: false,
				data: opmodeFMAC
      }]
    };

    console.log("chartData", chartDataFMAC);


    // Draw the rate chart
    //window.onload = function() {
      var ctxFMAC = document.getElementById('rateChart-FMAC').getContext('2d');
      window.rateBarChartFMAC = new Chart(ctxFMAC, {
        type: 'line',
        data: chartDataFMAC,
        options: {
          responsive: true,
          run_periods: opmodeFMAC,
          chartArea: {
            backgroundColor: 'rgba(251, 85, 85, 0.4)'
          },
          legend: {
            position: 'top',
          },
          title: {
            display: true,
            text: 'FMAC Rate Chart'
          }
        }
      });
      console.log("rate chart", window.rateBarChartFMAC);
    //};
  });

  heatmapLayerFMAC.redraw();

  var basemapsFMAC = {"OpenStreetMap": osmLayerFMAC};
  var overlayMapsFMAC = {"Heatmap (FMAC)": heatmapLayerFMAC, "Stations": stationsLayerFMAC};

  var mapFMAC = new L.map('map-FMAC', {
    zoom: 6,
    attributionControl: true,
    layers: [osmLayerFMAC, heatmapLayerFMAC, stationsLayerFMAC]
  });
  //mapFMAC.setView([51.945732, -1.926986], 6);
  mapFMAC.fitBounds(stationsLayerFMAC.getBounds().pad(0.5));

  L.control.layers(basemapsFMAC, overlayMapsFMAC).addTo(mapFMAC);

</script>


        </div> <!-- /.post-container -->

      <!-- Sidebar Container -->
      <div class="col-lg-3 col-lg-offset-0 col-md-3 col-md-offset-0 col-sm-12 col-xs-12 sidebar-container">

        <!-- Featured Tags -->
          <section>
          <!-- no hr -->
            <h5>
              <a href="/tags/">FEATURED TAGS</a>
            </h5>
            <div class="tags">
              <a href="/blog/tags/UKAC.html" title="UKAC" rel="5">UKAC</a>
              <a href="/blog/tags/Activation.html" title="Activation" rel="7">Activation</a>
            </div>
          </section>

          <hr />

          <!-- Short About -->
          <section class="visible-md visible-lg">
            <h5><a href="/about/">ABOUT ME</a></h5>
            <div class="short-about">
              <img id = "avatar_pic" src="/media/images/2m-UKAC.jpg" />
              <p>2E1HNK since 2000</p>
              <p>Should be studying for full license</p>
              <p>Too busy being a dad and having a job</p>
              <!-- Social Media Links -->
              <ul class="list-inline">
                <li>
                  <a target="_blank" href="https://twitter.com/2e1hnk">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                    </span>
                  </a>
                </li>
                <li>
                  <a target="_blank" href="https://github.com/2e1hnk">
                    <span class="fa-stack fa-lg">
                      <i class="fa fa-circle fa-stack-2x"></i>
                      <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                    </span>
                  </a>
                </li>
              </ul>
            </div>
          </section>

          <hr />

          <h5>RECENT POSTS</h3>
          <div class="widget">
            <ul>
                              <li><a href="/contests\ukac-may-2019.html">2m/70cm UKAC May 2019</a></li>                              <li><a href="/projects\satellite-station.html">2m/70cm Satellite Station</a></li>                              <li><a href="/blog\emsystech-raspi-lcd.html">Emsystech RaspiLCD</a></li>                              <li><a href="/projects\magloop.html">HF Magnetic Loop Antenna</a></li>                              <li><a href="/projects\suppliers.html">Suppliers</a></li>                          </ul>
          </div>

          <hr />

          <!-- Friends Blog -->

          <h5>FRIENDS</h5>
            <ul class="list-inline">
              <li><a href="https://g1ybb.uk/" target="_blank">G1YBB</a></li>
            </ul>

      </div> <!-- /.sidebar-container -->
    </div> <!-- /.row -->
  </div> <!-- /.container -->

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
          <ul class="list-inline text-center">
            <li>
              <a target="_blank" href="https://twitter.com/2e1hnk">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
            <li>
              <a target="_blank"  href="https://github.com/2e1hnk">
                <span class="fa-stack fa-lg">
                  <i class="fa fa-circle fa-stack-2x"></i>
                  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                </span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <!-- jQuery -->
  <script src="/media/js/jquery.min.js"></script>

  <!-- Bootstrap Core JavaScript -->
  <script src="/media/js/bootstrap.min.js"></script>

  <!-- Custom Theme JavaScript -->
  <script src="/media/js/hux-blog.min.js"></script>

  <!-- TOC -->
  <script type="text/javascript" src="/media/js/toc.js" async=""></script>


  <!-- async load function -->
  <script>
  function async(u, c) {
  var d = document, t = 'script',
  o = d.createElement(t),
  s = d.getElementsByTagName(t)[0];
  o.src = u;
  if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
  s.parentNode.insertBefore(o, s);
  }
  </script>

  <!--
  Because of the native support for backtick-style fenced code blocks
  right within the Markdown is landed in Github Pages,
  From V1.6, There is no need for Highlight.js,
  so Huxblog drops it officially.

  - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
  - https://help.github.com/articles/creating-and-highlighting-code-blocks/
  -->
  <!--
  <script>
  async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
    hljs.initHighlightingOnLoad();
  })
  </script>
  <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
  -->


  <!-- jquery.tagcloud.js -->
  <script>
  // only load tagcloud.js in tag.html
  if($('#tag_cloud').length !== 0){
  async("http://www.huweihuang.com/js/jquery.tagcloud.js",function(){
    $.fn.tagcloud.defaults = {
        //size: {start: 1, end: 1, unit: 'em'},
        color: {start: '#bbbbee', end: '#0085a1'},
    };
    $('#tag_cloud a').tagcloud();
  })
  }
  </script>

  <!--fastClick.js -->
  <script>
  async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
  var $nav = document.querySelector("nav");
  if($nav) FastClick.attach($nav);
  })
  </script>


                  
                        
  </body>
</html>